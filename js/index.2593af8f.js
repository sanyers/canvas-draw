(function(t){function e(e){for(var n,o,c=e[0],r=e[1],h=e[2],l=0,d=[];l<c.length;l++)o=c[l],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&d.push(a[o][0]),a[o]=0;for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n]);u&&u(e);while(d.length)d.shift()();return s.push.apply(s,h||[]),i()}function i(){for(var t,e=0;e<s.length;e++){for(var i=s[e],n=!0,o=1;o<i.length;o++){var r=i[o];0!==a[r]&&(n=!1)}n&&(s.splice(e--,1),t=c(c.s=i[0]))}return t}var n={},a={index:0},s=[];function o(t){return c.p+"js/"+({about:"about"}[t]||t)+"."+{about:"c74d7a63"}[t]+".js"}function c(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,c),i.l=!0,i.exports}c.e=function(t){var e=[],i=a[t];if(0!==i)if(i)e.push(i[2]);else{var n=new Promise((function(e,n){i=a[t]=[e,n]}));e.push(i[2]=n);var s,r=document.createElement("script");r.charset="utf-8",r.timeout=120,c.nc&&r.setAttribute("nonce",c.nc),r.src=o(t);var h=new Error;s=function(e){r.onerror=r.onload=null,clearTimeout(l);var i=a[t];if(0!==i){if(i){var n=e&&("load"===e.type?"missing":e.type),s=e&&e.target&&e.target.src;h.message="Loading chunk "+t+" failed.\n("+n+": "+s+")",h.name="ChunkLoadError",h.type=n,h.request=s,i[1](h)}a[t]=void 0}};var l=setTimeout((function(){s({type:"timeout",target:r})}),12e4);r.onerror=r.onload=s,document.head.appendChild(r)}return Promise.all(e)},c.m=t,c.c=n,c.d=function(t,e,i){c.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},c.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(c.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)c.d(i,n,function(e){return t[e]}.bind(null,n));return i},c.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return c.d(e,"a",e),e},c.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},c.p="/canvas-draw/",c.oe=function(t){throw console.error(t),t};var r=window["webpackJsonp"]=window["webpackJsonp"]||[],h=r.push.bind(r);r.push=e,r=r.slice();for(var l=0;l<r.length;l++)e(r[l]);var u=h;s.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"0f3d":function(t,e,i){},1173:function(t,e,i){"use strict";i("0f3d")},"220f":function(t,e,i){"use strict";i("2b10")},"2b10":function(t,e,i){},4990:function(t,e,i){},"56d7":function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var n=i("8bbf"),a=i.n(n),s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app",attrs:{id:"app"}},[i("router-view")],1)},o=[],c=(i("5c0b"),i("2877")),r={},h=Object(c["a"])(r,s,o,!1,null,null,null),l=h.exports,u=(i("d3b7"),i("3ca3"),i("ddb0"),i("6389")),d=i.n(u),v=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"home"},[i("canvas",{ref:"canvas",staticClass:"canvas"}),t.isCanvas?i("canvas-draw",{ref:"canvasDrawRef",on:{"on-close":t.closeCanvas,"on-save":t.saveCanvas,"on-upload":t.uploadCanvas,"on-down":t.downCanvas}}):t._e()],1)},p=[],f=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"canvas-draw"},[i("div",{staticClass:"canvas-tools"},[t._l(t.drawControl,(function(e){return i("i",{key:e.type,class:t.itemClassList(e),attrs:{title:e.title},on:{click:function(i){return t.onDrawControl(e)}}})})),i("el-input-number",{staticClass:"canvas-number",attrs:{size:"mini","controls-position":"right",min:1,max:10},on:{change:t.lineWidthChange},model:{value:t.lineWidth,callback:function(e){t.lineWidth=e},expression:"lineWidth"}}),i("input",{attrs:{type:"color",title:"颜色"},domProps:{value:t.color},on:{change:t.onColor}}),i("i",{staticClass:"canvas-iconfont icon-cv-baocun",attrs:{title:"保存"},on:{click:t.onSave}}),i("i",{staticClass:"canvas-iconfont icon-cv-upload",attrs:{title:"上传"},on:{click:t.onUpload}}),i("i",{staticClass:"canvas-iconfont icon-cv-down",attrs:{title:"下载"},on:{click:t.onDown}}),i("i",{staticClass:"canvas-iconfont icon-cv-guanbi",attrs:{title:"关闭"},on:{click:t.onClose}})],2)])},m=[],y=(i("99af"),i("d4ec")),g=i("bee2"),b=(i("fb6a"),function(){function t(e,i){var n=i.drawType,a=void 0===n?"line":n,s=i.drawColor,o=void 0===s?"rgba(19, 206, 102, 1)":s,c=i.lineWidth,r=void 0===c?5:c,h=i.sides,l=void 0===h?3:h,u=i.fillStyle,d=void 0===u?null:u,v=i.allowCallback,p=i.moveCallback;Object(y["a"])(this,t),this.canvas=e,this.width=e.width,this.height=e.height,this.ratio=e.width>e.clientWidth?e.width/e.clientWidth:1,this.ctx=e.getContext("2d"),this.isClickCanvas=!1,this.isMoveCanvas=!1,this.imgData=[],this.index=0,this.x=0,this.y=0,this.last=[this.x,this.y],this.drawType=a,this.drawColor=o,this.lineWidth=r,this.sides=l,this.fillStyle=d,this.allowCallback=v||function(){},this.moveCallback=p||function(){},this.bindMousemove=function(){},this.bindMousedown=function(){},this.bindMouseup=function(){},this.init()}return Object(g["a"])(t,[{key:"init",value:function(){this.fillStyle&&(this.ctx.fillStyle="#fff",this.ctx.fillRect(0,0,this.width,this.height)),this.gatherImage(),this.bindMousemove=this.onmousemove.bind(this),this.bindMousedown=this.onmousedown.bind(this),this.bindMouseup=this.onmouseup.bind(this);var t="mousedown",e="mouseup";"ontouchstart"in this.canvas?(this.isTouch=!0,t="touchstart",e="touchend"):this.isTouch=!1,this.canvas.addEventListener(t,this.bindMousedown),this.canvas.addEventListener(e,this.bindMouseup)}},{key:"getPoint",value:function(t){var e=t.changedTouches[0],i=e.pageX,n=e.pageY,a=e.target,s=a.getBoundingClientRect(),o=s.top,c=s.left,r=(i-c)*this.ratio,h=(n-o)*this.ratio;return{x:r,y:h}}},{key:"onmousedown",value:function(t){var e="mousemove";if(this.isTouch){var i=this.getPoint(t),n=i.x,a=i.y;t.offsetX=n,t.offsetY=a,e="touchmove"}this.canvas.addEventListener(e,this.bindMousemove),this.isClickCanvas=!0,this.x=t.offsetX,this.y=t.offsetY,this.last=[this.x,this.y]}},{key:"gatherImage",value:function(){this.imgData=this.imgData.slice(0,this.index+1);var t=this.ctx.getImageData(0,0,this.width,this.height);this.imgData.push(t),this.index=this.imgData.length-1,this.allowCallback(this.index>0,this.index<this.imgData.length-1)}},{key:"reSetImage",value:function(){this.ctx.clearRect(0,0,this.width,this.height),this.imgData.length>=1&&this.ctx.putImageData(this.imgData[this.index],0,0)}},{key:"onmousemove",value:function(t){if(this.isTouch){t.preventDefault();var e=this.getPoint(t),i=e.x,n=e.y;t.offsetX=i,t.offsetY=n}this.isMoveCanvas=!0;var a=t.offsetX,s=t.offsetY,o=a-this.x,c=s-this.y,r=[a,s];switch(this.drawType){case"pencil":var h=[this.last,r,this.lineWidth,this.drawColor,!0];this.moveCallback.apply(this,["pencil"].concat(h)),this.line.apply(this,h);break;case"line":var l=[this.last,r,this.lineWidth,this.drawColor];this.moveCallback.apply(this,["line"].concat(l)),this.line.apply(this,l);break;case"rect":var u=[this.x,this.y,o,c,this.lineWidth,this.drawColor];this.moveCallback.apply(this,["rect"].concat(u)),this.rect.apply(this,u);break;case"polygon":var d=[this.x,this.y,this.sides,o,c,this.lineWidth,this.drawColor];this.moveCallback.apply(this,["polygon"].concat(d)),this.polygon.apply(this,d);break;case"arc":var v=[this.x,this.y,o,c,this.lineWidth,this.drawColor];this.moveCallback.apply(this,["arc"].concat(v)),this.arc.apply(this,v);break;case"eraser":var p=[a,s,this.lineWidth];this.moveCallback.apply(this,["eraser"].concat(p)),this.eraser.apply(this,p);break}}},{key:"onmouseup",value:function(){this.isClickCanvas&&(this.isClickCanvas=!1,this.isTouch?this.canvas.removeEventListener("touchmove",this.bindMousemove):this.canvas.removeEventListener("mousemove",this.bindMousemove),this.isMoveCanvas&&(this.isMoveCanvas=!1,this.gatherImage(),this.moveCallback("gatherImage",this.index)))}},{key:"line",value:function(t,e,i,n,a){a||this.reSetImage(),this.ctx.beginPath(),this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.lineWidth=i,this.ctx.strokeStyle=n,this.ctx.moveTo(t[0],t[1]),this.ctx.lineTo(e[0],e[1]),this.ctx.closePath(),this.ctx.stroke(),a&&(this.last=e)}},{key:"rect",value:function(t,e,i,n,a,s){this.reSetImage(),this.ctx.lineWidth=a,this.ctx.strokeStyle=s,this.ctx.strokeRect(t,e,i,n)}},{key:"polygon",value:function(t,e,i,n,a,s,o){this.reSetImage();var c=i,r=360/c,h=Math.sqrt(Math.pow(n,2)+Math.pow(a,2));this.ctx.beginPath(),this.ctx.strokeStyle=o,this.ctx.lineWidth=s;for(var l=0;l<c;l++)this.ctx.lineTo(t+Math.sin((l*r+45)*Math.PI/180)*h,e+Math.cos((l*r+45)*Math.PI/180)*h);this.ctx.closePath(),this.ctx.stroke()}},{key:"arc",value:function(t,e,i,n,a,s){this.reSetImage(),this.ctx.beginPath(),this.ctx.lineWidth=a;var o=Math.sqrt(Math.pow(i,2)+Math.pow(n,2));this.ctx.arc(t,e,o,0,2*Math.PI,!1),this.ctx.strokeStyle=s,this.ctx.closePath(),this.ctx.stroke()}},{key:"eraser",value:function(t,e,i){this.ctx.save(),this.line(this.last,[t,e],2*i,"#fff",!0)}},{key:"cancel",value:function(){--this.index<0?this.index=0:(this.allowCallback(this.index>0,this.index<this.imgData.length-1),this.ctx.putImageData(this.imgData[this.index],0,0))}},{key:"go",value:function(){++this.index>this.imgData.length-1?this.index=this.imgData.length-1:(this.allowCallback(this.index>0,this.index<this.imgData.length-1),this.ctx.putImageData(this.imgData[this.index],0,0))}},{key:"clear",value:function(){this.imgData=[],this.ctx.clearRect(0,0,this.width,this.height),this.gatherImage()}},{key:"changeWay",value:function(t){var e=t.type,i=t.color,n=t.lineWidth,a=t.sides;this.ctx.globalCompositeOperation="eraser"===e?"destination-out":"source-over",this.drawType="color"!==e&&e||this.drawType,this.drawColor=i||this.drawColor,this.lineWidth=n||this.lineWidth,this.sides=a||this.sides}},{key:"getImageDataNow",value:function(){return this.imgData[this.index]}},{key:"destroy",value:function(){this.clear(),this.canvas.removeEventListener("mousedown",this.bindMousedown),this.canvas.removeEventListener("mouseup",this.bindMouseup),this.canvas=null,this.ctx=null}}]),t}()),w={name:"CanvasDraw",computed:{itemClassList:function(){var t=this;return function(e){return"canvas-iconfont ".concat(e.icon," ").concat(e.type===t.curryControl?"active":"")}}},data:function(){return{drawControl:[{title:"铅笔",type:"pencil",icon:"icon-cv-pencil",category:1},{title:"线条",type:"line",icon:"icon-cv-line",category:1},{title:"圆",type:"arc",icon:"icon-cv-tuoyuan",category:1},{title:"矩形",type:"rect",icon:"icon-cv-checkbox",category:1},{title:"橡皮擦",type:"eraser",icon:"icon-cv-xiangpica",category:1},{title:"撤回",type:"cancel",icon:"icon-cv-undo",category:2},{title:"前进",type:"go",icon:"icon-cv-redo",category:2},{title:"清屏",type:"clear",icon:"icon-cv-shanchu",category:2}],curryControl:"pencil",color:"#000000",lineWidth:5,allowCancel:!0,allowGo:!0,palette:null}},methods:{openCanvas:function(t){this.palette||(this.palette=new b(t,{drawColor:this.color,drawType:this.curryControl,lineWidth:this.lineWidth,fillStyle:!0}))},closeCanvas:function(){this.palette.destroy(),this.palette=null},lineWidthChange:function(){this.palette.changeWay({lineWidth:this.lineWidth})},onColor:function(t){this.color=t.target.value,this.palette.changeWay({color:this.color})},onDrawControl:function(t){switch(t.category){case 1:this.curryControl=t.type,this.palette.changeWay({type:this.curryControl});break;case 2:this.palette[t.type]();break;case 3:break;default:break}},onClose:function(){this.$emit("on-close")},onSave:function(){var t=this.palette.getImageDataNow();this.$emit("on-save",t)},onUpload:function(){this.$emit("on-upload")},onDown:function(){this.$emit("on-down")}}},C=w,x=(i("220f"),Object(c["a"])(C,f,m,!1,null,"069e8590",null)),k=x.exports,D={name:"Home",components:{CanvasDraw:k},data:function(){return{isCanvas:!0}},mounted:function(){var t=this;this.$nextTick((function(){var e=t.$refs["canvas"];e.width=e.clientWidth,e.height=e.clientHeight,t.$refs.canvasDrawRef.openCanvas(e)}))},methods:{closeCanvas:function(){alert("关闭画板")},saveCanvas:function(t){console.log(t)},uploadCanvas:function(){var t=this.$refs["canvas"],e="draw-".concat((new Date).getTime(),".png");t.toBlob((function(t){var i=new FormData;i.append("testId","111"),i.append("file",t,e);var n=new XMLHttpRequest;n.open("POST","/test",!0),n.send(i)}))},downCanvas:function(){var t=this.$refs["canvas"],e="draw-".concat((new Date).getTime(),".png"),i=t.toDataURL(),n=document.createElement("a");n.style.display="none",n.href=i,n.setAttribute("download",e),document.body.appendChild(n),n.click(),document.body.removeChild(n)}}},M=D,W=(i("1173"),Object(c["a"])(M,v,p,!1,null,"8e214f66",null)),T=W.exports;a.a.use(d.a);var P=[{path:"/",name:"Home",component:T},{path:"/about",name:"About",component:function(){return i.e("about").then(i.bind(null,"f820"))}}],S=new d.a({mode:"history",base:"/canvas-draw/",routes:P}),I=S,O=i("5880"),E=i.n(O);a.a.use(E.a);var j=new E.a.Store({state:{},mutations:{},actions:{},modules:{}}),L=(i("4990"),i("5f72")),_=i.n(L);i("0fae");a.a.config.productionTip=!1,a.a.use(_.a),new a.a({router:I,store:j,render:function(t){return t(l)}}).$mount("#app")},5880:function(t,e){t.exports=Vuex},"5c0b":function(t,e,i){"use strict";i("9c0c")},"5f72":function(t,e){t.exports=ELEMENT},6389:function(t,e){t.exports=VueRouter},"8bbf":function(t,e){t.exports=Vue},"9c0c":function(t,e,i){}});